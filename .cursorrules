# LC Helper - Chrome Extension Development Rules

## Project Overview
LC Helper is a Chrome extension (Manifest V3) that provides smart hints, topic classification, and contest tracking for competitive programming platforms (LeetCode, Codeforces, CodeChef).

## Architecture

### Core Components
- **Background Service Worker** (`background/service-worker.js`): Handles API calls, caching, streak tracking, contest fetching
- **Content Scripts** (`content/*.js`): Platform-specific scripts that inject UI and extract problem data
- **Popup** (`popup/`): Extension popup with settings, contests, and streak display
- **Styles** (`styles/hints-panel.css`): Shared CSS for hints panel UI

### Key Features
1. **AI-Powered Hints**: Generates progressive hints using OpenAI or Gemini API
2. **Contest Tracking**: Fetches and displays upcoming contests from multiple platforms
3. **Daily Streak System**: Tracks consecutive days of problem solving
4. **Auto-Detection**: Automatically detects when problems are solved (LeetCode)
5. **Caching**: Caches hints to reduce API calls

## Code Style & Conventions

### JavaScript
- Use IIFE pattern for content scripts: `(function() { 'use strict'; ... })();`
- Always use `async/await` for asynchronous operations
- Use `chrome.storage.local` for large data (contests, hints cache)
- Use `chrome.storage.sync` for user settings (API keys, preferences)
- Handle extension context invalidation gracefully (check `chrome.runtime.id`)
- Use safe wrappers for storage operations when context may be invalidated

### Naming Conventions
- CSS classes: Use `lch-` prefix (e.g., `lch-panel`, `lch-fab`)
- Functions: camelCase (e.g., `extractProblemData`, `generateHints`)
- Constants: UPPER_SNAKE_CASE for true constants
- Variables: camelCase with descriptive names

### Error Handling
- Always wrap API calls in try-catch blocks
- Provide user-friendly error messages
- Log errors to console with context: `console.error('LC Helper: Error message', error)`
- Gracefully degrade when extension context is invalidated

## File Structure Guidelines

### Content Scripts
- Each platform has its own content script (`leetcode.js`, `codeforces.js`, `codechef.js`)
- Extract problem data using platform-specific selectors
- Create FAB (Floating Action Button) for hints panel
- Handle panel creation, toggling, and hint loading
- Implement "Mark as Solved" functionality with streak tracking

### Background Service Worker
- Handle all API communication (OpenAI, Gemini, contest APIs)
- Implement caching logic for hints
- Manage streak system with daily checks
- Fetch and cache contest data
- Set up alarms for reminders and daily checks

### Popup
- Three tabs: Contests, Streak, Settings
- Load and display contest data with filtering
- Show streak statistics with motivational messages
- Manage user settings (API keys, preferences)

## API Integration

### AI Hints Generation
- Support both OpenAI and Gemini APIs
- Generate progressive hints (3 levels: Gentle Push, Stronger Nudge, Almost There)
- Include topic classification with time complexity
- Cache hints by problem URL to reduce API calls
- Allow force refresh to bypass cache

### Contest APIs
- Codeforces: `https://codeforces.com/api/contest.list`
- LeetCode: Use kontests.net API or fallback
- CodeChef: Use kontests.net API or direct CodeChef API
- Cache contest data for 1 hour
- Support notifications with configurable reminder time

## Storage Schema

### chrome.storage.local
- `contests`: Array of contest objects
- `lastFetch`: Timestamp of last contest fetch
- `notifiedContests`: Array of contest IDs with notifications enabled
- `streakData`: Object with streak statistics
- `solved_{problemKey}`: Problem solve data
- `hints_{problemKey}`: Cached hints data

### chrome.storage.sync
- `apiKey`: User's API key
- `apiProvider`: 'openai' or 'gemini'
- `notifyContests`: Boolean for contest notifications
- `reminderTime`: Minutes before contest to remind
- `autoShowPanel`: Boolean to auto-open hints panel
- `autoDetectSolved`: Boolean to auto-detect solved problems

## UI/UX Guidelines

### Hints Panel
- Modern dark theme with gradient accents
- Smooth animations and transitions
- Progressive hint revelation (click to reveal)
- Cache indicator with refresh option
- Feedback system for hint quality
- "Mark as Solved" button prominently displayed

### FAB (Floating Action Button)
- Fixed position bottom-right
- Gradient background with hover effects
- Right-click for quick "Mark as Solved"
- High z-index to appear above page content

### Streak Celebration
- Animated celebration modal for milestones
- Different messages for streak milestones (7, 30, 50, 100, 365 days)
- Visual feedback with emojis and animations

## Platform-Specific Implementation

### LeetCode
- Auto-detect solved problems via fetch interceptor
- Monitor `/submissions/detail/{id}/check/` endpoint
- Extract problem data from `[data-cy="question-title"]` and `[data-cy="question-content"]`
- Handle extension context invalidation gracefully

### Codeforces
- Extract problem data from `.title` and `.problem-statement`
- Map problem letter (A-G) to difficulty
- Extract tags from `.tag-box`

### CodeChef
- Extract problem data from `h1` or `.problem-name`
- Handle various page layouts

## Best Practices

1. **Performance**
   - Cache hints aggressively to reduce API calls
   - Debounce rapid user interactions
   - Use efficient DOM selectors
   - Minimize storage operations

2. **Security**
   - Never log API keys
   - Validate user input
   - Sanitize HTML output (use `escapeHtml` function)
   - Use HTTPS for all API calls

3. **Reliability**
   - Handle network failures gracefully
   - Provide fallback options when APIs fail
   - Check extension context validity before operations
   - Use safe wrappers for storage operations

4. **User Experience**
   - Show loading states during API calls
   - Provide clear error messages
   - Give immediate feedback for user actions
   - Use animations sparingly but effectively

## Testing Considerations

- Test on all three platforms (LeetCode, Codeforces, CodeChef)
- Verify extension works after page reloads
- Test with invalidated extension context
- Verify caching works correctly
- Test streak system across day boundaries
- Verify contest notifications work

## Common Patterns

### Safe Storage Operations
```javascript
async function safeStorageGet(key) {
  if (!isExtensionContextValid()) return {};
  try {
    return await chrome.storage.local.get(key);
  } catch (e) {
    console.log('LC Helper: Storage access failed:', e.message);
    return {};
  }
}
```

### Problem Data Extraction
```javascript
function extractProblemData() {
  // Platform-specific selectors
  const titleEl = document.querySelector('...');
  const descriptionEl = document.querySelector('...');
  // Extract and return structured data
  return { title, description, difficulty, tags, url };
}
```

### Cache Key Generation
```javascript
function generateCacheKey(url) {
  return url
    .replace(/^https?:\/\//, '')
    .replace(/[^a-zA-Z0-9]/g, '_')
    .slice(0, 100);
}
```

## Dependencies
- Chrome Extension Manifest V3
- Google Fonts (Space Grotesk, JetBrains Mono)
- External APIs: OpenAI, Google Gemini, Codeforces API, kontests.net

## Notes
- Extension supports Safari with `browser_specific_settings`
- Uses `browser-polyfill.js` for cross-browser compatibility
- All content scripts are injected with `browser-polyfill.js` first


-Dont create .md or documentation file before asking and if not neccessary 