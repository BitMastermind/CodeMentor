<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CodeMentor</title>
  <link rel="stylesheet" href="popup.css">
</head>

<body>
  <div class="container">

    <!-- Streak Dashboard Section -->
    <section id="streak-section" class="streak-dashboard">
      <div class="streak-header">
        <div class="streak-main">
          <div class="streak-flame">üî•</div>
          <div class="streak-info">
            <div class="streak-number" id="currentStreak">0</div>
            <div class="streak-label">Day Streak</div>
          </div>
        </div>
        <div class="streak-status" id="streakStatus">
          <span class="status-dot"></span>
          <span class="status-text">Not solved today</span>
        </div>
      </div>

      <div class="streak-progress">
        <div class="progress-bar">
          <div class="progress-fill" id="streakProgress"></div>
        </div>
        <div class="progress-label" id="progressLabel">Keep going!</div>
      </div>

      <div class="streak-stats two-columns">
        <div class="stat-item">
          <div class="stat-value-container">
            <div class="stat-value" id="todayCount">0</div>
            <button class="refresh-today-btn" id="refreshTodayBtn" title="Refresh from APIs">üîÑ</button>
          </div>
          <div class="stat-label">Today</div>
        </div>
        <div class="stat-item">
          <div class="stat-value" id="longestStreak">0</div>
          <div class="stat-label">Best Streak</div>
        </div>
      </div>
    </section>

    <!-- Tab Navigation -->
    <nav class="tabs">
      <button class="tab active" data-tab="contests">
        <span class="tab-icon">üìÖ</span>
        Contests
      </button>
      <button class="tab" data-tab="favorites">
        <span class="tab-icon">‚ù§Ô∏è</span>
        Favorites
      </button>
      <button class="tab" data-tab="settings">
        <span class="tab-icon">‚öôÔ∏è</span>
        Settings
      </button>
    </nav>

    <!-- Contests Tab -->
    <section class="tab-content active" id="contests-tab">
      <div class="section-header">
        <h2>Upcoming Contests</h2>
        <button class="refresh-btn" id="refreshContests" title="Refresh">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="23 4 23 10 17 10"></polyline>
            <polyline points="1 20 1 14 7 14"></polyline>
            <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path>
          </svg>
        </button>
      </div>

      <!-- Platform Filters -->
      <div class="filters">
        <button class="filter-btn active" data-platform="all">All</button>
        <button class="filter-btn" data-platform="leetcode">
          <span class="platform-dot leetcode"></span>
          LeetCode
        </button>
        <button class="filter-btn" data-platform="codeforces">
          <span class="platform-dot codeforces"></span>
          Codeforces
        </button>
        <button class="filter-btn" data-platform="codechef">
          <span class="platform-dot codechef"></span>
          CodeChef
        </button>
      </div>

      <!-- Contest List -->
      <div class="contest-list" id="contestList">
        <div class="loading">
          <div class="spinner"></div>
          <span>Loading contests...</span>
        </div>
      </div>
    </section>

    <!-- Favorites Tab -->
    <section class="tab-content" id="favorites-tab">
      <div class="section-header">
        <h2>Favorite Problems</h2>
        <div class="favorites-header-actions">
          <span class="favorites-count" id="favoritesCount">0 saved</span>
          <button class="pick-one-btn" id="pickOneBtn" title="Pick a random favorite">
            <img src="../assets/shuffle.svg" alt="Shuffle" width="16" height="16"
              style="display: inline-block; vertical-align: middle;">
            Pick One
          </button>
        </div>
      </div>
      <div class="favorites-list" id="favoritesList">
        <div class="empty-state">
          <div class="empty-state-icon">‚ù§Ô∏è</div>
          <p>No favorites yet. Add problems from any platform!</p>
        </div>
      </div>
    </section>

    <!-- Settings Tab -->
    <section class="tab-content" id="settings-tab">
      <div class="settings-group">
        <h3>üë§ Platform Usernames</h3>
        <p class="settings-desc">Enter your usernames to enable unified streak tracking across all platforms.</p>
        <div class="input-group">
          <label for="leetcodeUsername">LeetCode Username</label>
          <input type="text" id="leetcodeUsername" placeholder="e.g., tourist" autocomplete="off">
        </div>
        <div class="input-group">
          <label for="codeforcesUsername">Codeforces Handle</label>
          <input type="text" id="codeforcesUsername" placeholder="e.g., tourist" autocomplete="off">
        </div>
        <div class="input-group">
          <label for="codechefUsername">CodeChef Username</label>
          <input type="text" id="codechefUsername" placeholder="e.g., gennady.korotkevich" autocomplete="off">
        </div>
      </div>

      <div class="settings-group">
        <h3>üîë API Configuration</h3>
        <p class="settings-desc">Configure your AI provider and API key. Your API key is stored locally and only used to communicate directly with your chosen AI provider.</p>
        <div class="input-group">
          <label for="apiProvider">AI Provider</label>
          <select id="apiProvider">
            <optgroup label="Best Accuracy (Paid)">
              <option value="openai">Best Accuracy (OpenAI ‚Äì GPT/o-series)</option>
              <option value="claude">Best Accuracy (Claude)</option>
              <option value="gemini">Gemini (Cost‚ÄëFriendly Best)</option>
            </optgroup>
            <optgroup label="Free / Open Source">
              <option value="groq">Best Free (Groq ‚Äì Llama 3.x 70B)</option>
              <option value="together">Together AI ‚Äì Large Open Model</option>
              <option value="huggingface">Hugging Face ‚Äì Open Model</option>
              <option value="openrouter">Bring Your Own (OpenRouter)</option>
              <option value="custom">Custom / Self‚Äëhosted Model</option>
            </optgroup>
          </select>
        </div>
        <div class="input-group" id="customEndpointGroup" style="display: none;">
          <label for="customEndpoint">Custom Endpoint URL</label>
          <input type="text" id="customEndpoint" placeholder="https://api.example.com/v1" autocomplete="off">
        </div>
        <div class="input-group" id="customModelGroup" style="display: none;">
          <label for="customModel">Model Name</label>
          <input type="text" id="customModel" placeholder="gpt-4o, llama-3-70b, etc." autocomplete="off">
        </div>
        <div class="input-group">
          <label for="apiKey">API Key</label>
          <div class="input-wrapper">
            <input type="password" id="apiKey" placeholder="Enter your API key..." autocomplete="off">
            <button class="toggle-visibility" id="toggleApiKey">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                class="eye-icon">
                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                <circle cx="12" cy="12" r="3"></circle>
              </svg>
            </button>
          </div>
          <a href="#" target="_blank" class="help-link" id="apiKeyLink">Get your API key ‚Üí</a>
        </div>
        <div class="security-notice">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
            style="flex-shrink: 0;">
            <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
            <path d="M9 12l2 2 4-4"></path>
          </svg>
          <div>
            <strong>Security Note:</strong> Your API key is encrypted and stored locally in your browser. It's only used to communicate directly with your chosen AI provider. API keys are transmitted securely using HTTPS headers only (never in URLs). Keep your API key private and never share it with anyone.
          </div>
        </div>
      </div>

      <div class="settings-group">
        <h3>üîî Notifications</h3>
        <div class="toggle-group">
          <label class="toggle-label">
            <span>Contest Reminders</span>
            <input type="checkbox" id="notifyContests" checked>
            <span class="toggle-switch"></span>
          </label>
          <p class="toggle-desc">Get notified before contests start</p>
        </div>
        <div class="input-group">
          <label for="reminderTime">Remind me before</label>
          <select id="reminderTime">
            <option value="15">15 minutes</option>
            <option value="30" selected>30 minutes</option>
            <option value="60">1 hour</option>
            <option value="120">2 hours</option>
            <option value="1440">1 day</option>
          </select>
        </div>
      </div>

      <div class="settings-group">
        <h3>üé® Preferences</h3>
        <div class="toggle-group">
          <label class="toggle-label">
            <span>Auto-show Hints Panel</span>
            <input type="checkbox" id="autoShowPanel">
            <span class="toggle-switch"></span>
          </label>
          <p class="toggle-desc">Automatically open hints panel on problem pages</p>
        </div>
        <div class="toggle-group">
          <label class="toggle-label">
            <span>Enable Analytics</span>
            <input type="checkbox" id="analyticsEnabled" checked>
            <span class="toggle-switch"></span>
          </label>
          <p class="toggle-desc">Help us improve by sharing anonymous usage data</p>
        </div>
      </div>

      <div class="settings-group">
        <h3>üí¨ Feedback & Support</h3>
        <p class="settings-desc">We'd love to hear from you! Share your feedback, report bugs, or suggest features.</p>
        <button class="btn-secondary" id="openFeedbackBtn" style="width: 100%; margin-top: 8px;">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
            style="margin-right: 8px;">
            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
          </svg>
          Send Feedback
        </button>
      </div>

      <button class="save-btn" id="saveSettings">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
          stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <polyline points="20 6 9 17 4 12"></polyline>
        </svg>
        Save Settings
      </button>
    </section>
  </div>

  <!-- Login Modal -->
  <div id="loginModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Login</h3>
        <button class="modal-close" id="closeLoginModal">&times;</button>
      </div>
      <div class="modal-body">
        <div class="input-group">
          <label for="loginEmail">Email</label>
          <input type="email" id="loginEmail" placeholder="your@email.com" autocomplete="email">
        </div>
        <div class="input-group">
          <label for="loginPassword">Password</label>
          <input type="password" id="loginPassword" placeholder="Enter your password" autocomplete="current-password">
        </div>
        <div id="loginError" class="error-message" style="display: none;"></div>
        <button class="btn-primary" id="submitLogin" style="width: 100%; margin-top: 16px;">Login</button>
        <p style="text-align: center; margin-top: 12px; font-size: 12px; color: var(--text-muted);">
          Don't have an account? <a href="#" id="showRegister" style="color: var(--accent);">Register</a>
        </p>
      </div>
    </div>
  </div>

  <!-- Register Modal -->
  <div id="registerModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Register</h3>
        <button class="modal-close" id="closeRegisterModal">&times;</button>
      </div>
      <div class="modal-body">
        <div class="input-group">
          <label for="registerEmail">Email</label>
          <input type="email" id="registerEmail" placeholder="your@email.com" autocomplete="email">
        </div>
        <div class="input-group">
          <label for="registerPassword">Password</label>
          <input type="password" id="registerPassword" placeholder="At least 8 characters" autocomplete="new-password">
        </div>
        <div class="input-group">
          <label for="registerPasswordConfirm">Confirm Password</label>
          <input type="password" id="registerPasswordConfirm" placeholder="Confirm your password"
            autocomplete="new-password">
        </div>
        <div id="registerError" class="error-message" style="display: none;"></div>
        <button class="btn-primary" id="submitRegister" style="width: 100%; margin-top: 16px;">Register</button>
        <p style="text-align: center; margin-top: 12px; font-size: 12px; color: var(--text-muted);">
          Already have an account? <a href="#" id="showLogin" style="color: var(--accent);">Login</a>
        </p>
      </div>
    </div>
  </div>

  <!-- Feedback Modal -->
  <div id="feedbackModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Send Feedback</h3>
        <button class="modal-close" id="closeFeedbackModal">&times;</button>
      </div>
      <div class="modal-body">
        <div class="input-group">
          <label for="feedbackType">Type</label>
          <select id="feedbackType">
            <option value="bug">üêõ Bug Report</option>
            <option value="feature">üí° Feature Request</option>
            <option value="improvement">‚ú® Improvement</option>
            <option value="other">üí¨ Other</option>
          </select>
        </div>
        <div class="input-group">
          <label for="feedbackEmail">Email (optional)</label>
          <input type="email" id="feedbackEmail" placeholder="your@email.com" autocomplete="email">
          <p class="input-hint">We'll only use this to respond to your feedback</p>
        </div>
        <div class="input-group">
          <label for="feedbackMessage">Message</label>
          <textarea id="feedbackMessage" rows="6" placeholder="Tell us what's on your mind..."></textarea>
        </div>
        <div id="feedbackError" class="error-message" style="display: none;"></div>
        <div id="feedbackSuccess" class="success-message" style="display: none;">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
            style="margin-right: 8px;">
            <polyline points="20 6 9 17 4 12"></polyline>
          </svg>
          Thank you for your feedback! We'll review it soon.
        </div>
        <button class="btn-primary" id="submitFeedback" style="width: 100%; margin-top: 16px;">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
            style="margin-right: 8px;">
            <line x1="22" y1="2" x2="11" y2="13"></line>
            <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
          </svg>
          Send Feedback
        </button>
      </div>
    </div>
  </div>

  <script src="../utils/errorTracking.js"></script>
  <script src="../utils/analytics.js"></script>
  <script src="popup.js"></script>
</body>

</html>